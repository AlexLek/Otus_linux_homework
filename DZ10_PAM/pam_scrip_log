Script started on Вс 13 окт 2019 20:39:14
[root@otuslinux ~]# ll
total 16
-rw-------. 1 root root 5570 июн  1 17:18 anaconda-ks.cfg
-rw-------. 1 root root 5300 июн  1 17:18 original-ks.cfg
-rw-r--r--. 1 root root    0 окт 13 20:39 typescript
[root@otuslinux ~]# sudo useradd admin_u1 && sudo useradd admin_u2 && sudo useradd normal_u1 && sudo useradd normal_u2
[root@otuslinux ~]# sudo groupadd admins
[root@otuslinux ~]# sudo usermod -a -G admins admin_u1 && sudo usermod -a -G admins admin_u2
[root@otuslinux ~]# echo "Otus2019"|sudo passwd --stdin admin_u1 && echo "Otus2019" | sudo passwd --stdin admin_u2  && echo "Otus2019" | sudo passwd --stdin normal_u1 && echo "Otus2019" | sudo passwd --stdin normal_u2
Changing password for user admin_u1.
passwd: all authentication tokens updated successfully.
Changing password for user admin_u2.
passwd: all authentication tokens updated successfully.
Changing password for user normal_u1.
passwd: all authentication tokens updated successfully.
Changing password for user normal_u2.
passwd: all authentication tokens updated successfully.
[root@otuslinux ~]# sudo bash -c "sed -i 's/^PasswordAuthentication.*$/PasswordAuthentication yes/' /etc/ssh/sshd_config && systemctl restart sshd.service"
[root@otuslinux ~]# 
[root@otuslinux ~]# 
[root@otuslinux ~]# 
[root@otuslinux ~]# username=admin_u1
[root@otuslinux ~]# if getent group admins | grep &>/dev/null "\b${username}\b"; then
>     echo true
> else
>     echo false
> fi
true
[root@otuslinux ~]# $(date +%a)
bash: Вс: command not found
[root@otuslinux ~]# locale
LANG=ru_RU.UTF-8
LC_CTYPE="ru_RU.UTF-8"
LC_NUMERIC="ru_RU.UTF-8"
LC_TIME="ru_RU.UTF-8"
LC_COLLATE="ru_RU.UTF-8"
LC_MONETARY="ru_RU.UTF-8"
LC_MESSAGES="ru_RU.UTF-8"
LC_PAPER="ru_RU.UTF-8"
LC_NAME="ru_RU.UTF-8"
LC_ADDRESS="ru_RU.UTF-8"
LC_TELEPHONE="ru_RU.UTF-8"
LC_MEASUREMENT="ru_RU.UTF-8"
LC_IDENTIFICATION="ru_RU.UTF-8"
LC_ALL=
[root@otuslinux ~]# locale -a | grep en_US
en_US
en_US.iso88591
en_US.iso885915
en_US.utf8
[root@otuslinux ~]# touch /etc/sysconfig/i18n
[root@otuslinux ~]# vi /etc/sysconfig/i18n
[root@otuslinux ~]# exit

Script done on Вс 13 окт 2019 21:02:23
Script started on Вс 13 окт 2019 21:03:50
[root@otuslinux ~]# $(date +%a)
bash: Вс: command not found
[root@otuslinux ~]# $(date +%a)^C
[root@otuslinux ~]# ^C
[root@otuslinux ~]# cat <<'EOF' >> /usr/local/bin/test_login.sh
> #!/bin/bash
> if [ $(date +%a) = "Вс" || $(date +%a) = "Сб" ]; then
> if getent group admins | grep &>/dev/null "\b${PAM_USER}\b"; then
>     exit 0
> else
>     exit 1
> fi
> else 
> exit 0
> fi
> EOF
[root@otuslinux ~]# cat /usr/local/bin/test_login.sh
#!/bin/bash
if [ $(date +%a) = "Вс" || $(date +%a) = "Сб" ]; then
if getent group admins | grep &>/dev/null "\b${PAM_USER}\b"; then
    exit 0
else
    exit 1
fi
else 
exit 0
fi
[root@otuslinux ~]# vi /usr/local/bin/test_login.sh
[root@otuslinux ~]# vi /etc/pam.d/sshd
[root@otuslinux ~]# yum install pam_exec
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
 * base: mirror.logol.ru
 * extras: mirror.logol.ru
 * updates: mirror.logol.ru
No package pam_exec available.
Error: Nothing to do
[root@otuslinux ~]# yum install pam_exec --enable-repo=epel-release
Loaded plugins: fastestmirror
Usage: yum [options] COMMAND

List of Commands:

check          Check for problems in the rpmdb
check-update   Check for available package updates
clean          Remove cached data
deplist        List a package's dependencies
distribution-synchronization Synchronize installed packages to the latest available versions
downgrade      downgrade a package
erase          Remove a package or packages from your system
fs             Acts on the filesystem data of the host, mainly for removing docs/lanuages for minimal hosts.
fssnapshot     Creates filesystem snapshots, or lists/deletes current snapshots.
groups         Display, or use, the groups information
help           Display a helpful usage message
history        Display, or use, the transaction history
info           Display details about a package or group of packages
install        Install a package or packages on your system
list           List a package or groups of packages
load-transaction load a saved transaction from filename
makecache      Generate the metadata cache
provides       Find what package provides the given value
reinstall      reinstall a package
repo-pkgs      Treat a repo. as a group of packages, so we can install/remove all of them
repolist       Display the configured software repositories
search         Search package details for the given string
shell          Run an interactive yum shell
swap           Simple way to swap packages, instead of using shell
update         Update a package or packages on your system
update-minimal Works like upgrade, but goes to the 'newest' package match which fixes a problem that affects your system
updateinfo     Acts on repository update information
upgrade        Update packages taking obsoletes into account
version        Display a version for the machine and/or available repos.


Command line error: no such option: --enable-repo
[root@otuslinux ~]# yum install pam_exec --enable-repo=*
Loaded plugins: fastestmirror
Usage: yum [options] COMMAND

List of Commands:

check          Check for problems in the rpmdb
check-update   Check for available package updates
clean          Remove cached data
deplist        List a package's dependencies
distribution-synchronization Synchronize installed packages to the latest available versions
downgrade      downgrade a package
erase          Remove a package or packages from your system
fs             Acts on the filesystem data of the host, mainly for removing docs/lanuages for minimal hosts.
fssnapshot     Creates filesystem snapshots, or lists/deletes current snapshots.
groups         Display, or use, the groups information
help           Display a helpful usage message
history        Display, or use, the transaction history
info           Display details about a package or group of packages
install        Install a package or packages on your system
list           List a package or groups of packages
load-transaction load a saved transaction from filename
makecache      Generate the metadata cache
provides       Find what package provides the given value
reinstall      reinstall a package
repo-pkgs      Treat a repo. as a group of packages, so we can install/remove all of them
repolist       Display the configured software repositories
search         Search package details for the given string
shell          Run an interactive yum shell
swap           Simple way to swap packages, instead of using shell
update         Update a package or packages on your system
update-minimal Works like upgrade, but goes to the 'newest' package match which fixes a problem that affects your system
updateinfo     Acts on repository update information
upgrade        Update packages taking obsoletes into account
version        Display a version for the machine and/or available repos.


Command line error: no such option: --enable-repo
[root@otuslinux ~]# for pkg in epel-release pam_script; do yum install -y $pkg; done
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
 * base: mirror.logol.ru
 * extras: mirror.logol.ru
 * updates: mirror.logol.ru
Resolving Dependencies
--> Running transaction check
---> Package epel-release.noarch 0:7-11 will be installed
--> Finished Dependency Resolution

Dependencies Resolved

=====================================================================================================
 Package                     Arch                  Version               Repository             Size
=====================================================================================================
Installing:
 epel-release                noarch                7-11                  extras                 15 k

Transaction Summary
=====================================================================================================
Install  1 Package

Total download size: 15 k
Installed size: 24 k
Downloading packages:
epel-release-7-11.noarch.rpm                                                  |  15 kB  00:00:00     
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
  Installing : epel-release-7-11.noarch                                                          1/1 
  Verifying  : epel-release-7-11.noarch                                                          1/1 

Installed:
  epel-release.noarch 0:7-11                                                                         

Complete!
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
epel/x86_64/metalink                                                          |  29 kB  00:00:00     
 * base: mirror.logol.ru
 * epel: fedora-epel.koyanet.lv
 * extras: mirror.logol.ru
 * updates: mirror.logol.ru
epel                                                                          | 5.3 kB  00:00:00     
(1/3): epel/x86_64/group_gz                                                   |  88 kB  00:00:00     
(2/3): epel/x86_64/updateinfo                                                 | 1.0 MB  00:00:00     
(3/3): epel/x86_64/primary_db                                                 | 6.9 MB  00:00:01     
Resolving Dependencies
--> Running transaction check
---> Package pam_script.x86_64 0:1.1.8-1.el7 will be installed
--> Finished Dependency Resolution

Dependencies Resolved

=====================================================================================================
 Package                  Arch                 Version                      Repository          Size
=====================================================================================================
Installing:
 pam_script               x86_64               1.1.8-1.el7                  epel                28 k

Transaction Summary
=====================================================================================================
Install  1 Package

Total download size: 28 k
Installed size: 62 k
Downloading packages:
warning: /var/cache/yum/x86_64/7/epel/packages/pam_script-1.1.8-1.el7.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID 352c64e5: NOKEY
Public key for pam_script-1.1.8-1.el7.x86_64.rpm is not installed
pam_script-1.1.8-1.el7.x86_64.rpm                                             |  28 kB  00:00:00     
Retrieving key from file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7
Importing GPG key 0x352C64E5:
 Userid     : "Fedora EPEL (7) <epel@fedoraproject.org>"
 Fingerprint: 91e9 7d7c 4a5e 96f1 7f3e 888f 6a2f aea2 352c 64e5
 Package    : epel-release-7-11.noarch (@extras)
 From       : /etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
  Installing : pam_script-1.1.8-1.el7.x86_64                                                     1/1 
  Verifying  : pam_script-1.1.8-1.el7.x86_64                                                     1/1 

Installed:
  pam_script.x86_64 0:1.1.8-1.el7                                                                    

Complete!
[root@otuslinux ~]# visudo /etc/su
subgid          subuid          sudo.conf       sudoers         sudoers.d/      sudo-ldap.conf
[root@otuslinux ~]# visudo /etc/su
subgid          subuid          sudo.conf       sudoers         sudoers.d/      sudo-ldap.conf
[root@otuslinux ~]# visudo /etc/sudoers.d/^C
[root@otuslinux ~]# usermod -G wheel normal_u2
[root@otuslinux ~]# visudo /etc/sudoers.d/normal_u2
usage: visudo [-chqsV] [-f sudoers]
[root@otuslinux ~]# visudo -f /etc/sudoers.d/normal_u2
[root@otuslinux ~]# cat /etc/sudoers.d/normal_u2
normal_u2 	ALL=(ALL)       NOPASSWD: ALL
[root@otuslinux ~]# exit

Script done on Вс 13 окт 2019 21:22:00
